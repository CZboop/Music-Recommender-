{% extends 'boilerplate.html' %}

{% block stylesheet %}<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/boilerplate.css') }}">{% endblock %}

{% block content %}
    <h1>{% block title %}Recommendations {% endblock %}</h1>
    {% if logged_in == True %}
    {% if can_recommend == True %}
      {% for rec in recs %}
        <p>{{rec}}</p>

      {% endfor %}
      {% if recs|length <= 3 %}
        <p>We're struggling to find artists for you that we haven't recommended already!</p>
        <p><a href="{{ url_for('rate_artist') }}">Rate more artists</a> to get more new recommendations.</p>
      {% endif %}
      <h3>Past Recommendations</h3>
      {% if past_recs|length >= 1 %}
        {% for past_rec in past_recs %}
          <p>{{past_rec}}</p>
        {% endfor %}
      {% else %}
        <p>You don't have any previous recommendations yet. When you do, they will show up here.</p>
      {% endif %}
    {% else %}
      {% if num_rated <= 9 %}
        <p><a href="{{ url_for('rate_artist') }}">Rate {{ 10 - num_rated }} more artists</a> to get recommendations! </p>
      {% endif %}
    {% endif %}
    {% else %}
    <a href="{{ url_for('login') }}">Log in to get recommendations!</a>
    {% endif %}
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type=text/javascript>
  $(function (){
    recs = getRecommendations()

        function getRecommendations(){
          $.ajax({
            url: "/recommend",
            type: "POST",
            dataType: "json",
            beforeSend: function(){
              $('#recs-loading').show();
            },
            complete: function(data){
              $('#recs-loading').hide();
              const recs = JSON.parse(data.responseText)['recs']
              const pastRecs = JSON.parse(data.responseText)['past_recs']
              for (rec of recs){
                let pNode = document.createElement("p");
                pNode.textContent = rec
                $(recs_container.appendChild(pNode));
              }
              if (pastRecs.length > 0){
                const pastRecHeading = document.createElement("h2");
                pastRecHeading.textContent = "Past Recommendations";
                recs_container.appendChild(pastRecHeading);
                for (pastRec of pastRecs){
                  let pNode = document.createElement("p");
                  pNode.textContent = pastRec
                  $(recs_container.appendChild(pNode));
                }
              }
            }
          });
        }
          })
</script>
<div id='recs-loading'>LOADING...</div>
<div id='recs_container'></div>

{% endblock %}
