{% extends 'boilerplate.html' %}

{% block stylesheet %}<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/boilerplate.css') }}">{% endblock %}

{% block content %}
    <h1>{% block title %}Recommendations {% endblock %}</h1>
    {% if logged_in != True %}
    <a href="{{ url_for('login') }}">Log in to get recommendations!</a>
    {% endif %}
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type=text/javascript>
  $(function (){
    recs = getRecommendations()

        function getRecommendations(){
          $.ajax({
            url: "/recommend",
            type: "POST",
            dataType: "json",
            beforeSend: function(){
              $('#recs-loading').show();
            },
            complete: function(data){
              $('#recs-loading').hide();
              const recs = JSON.parse(data.responseText)['recs']
              const pastRecs = JSON.parse(data.responseText)['past_recs']
              for (rec of recs){
                let pNode = document.createElement("p");
                pNode.textContent = rec
                $(recs_container.appendChild(pNode));
              }
              if (pastRecs.length > 0){
                const pastRecHeading = document.createElement("h2");
                pastRecHeading.textContent = "Past Recommendations";
                recs_container.appendChild(pastRecHeading);
                for (pastRec of pastRecs){
                  let pNode = document.createElement("p");
                  pNode.textContent = pastRec
                  $(recs_container.appendChild(pNode));
                }
              }
            }
          });
        }
          })
</script>
<div id='recs-loading'>LOADING...</div>
<div id='recs_container'></div>

{% endblock %}
